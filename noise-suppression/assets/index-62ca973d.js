var z=Object.defineProperty;var W=(r,o,e)=>o in r?z(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var p=(r,o,e)=>(W(r,typeof o!="symbol"?o+"":o,e),e);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function e(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(i){if(i.ep)return;i.ep=!0;const c=e(i);fetch(i.href,c)}})();const O=navigator.mediaDevices.getSupportedConstraints();class j{constructor(o){p(this,"name");p(this,"checkbox");this.name=o;const e=document.querySelector(`#${o}`);if(!e)throw new Error("Cannot fined checkbox");this.checkbox=e,(O[o]===!1||O[o]===void 0)&&(this.checkbox.disabled=!0)}get checked(){return this.checkbox.checked}}const g=document.querySelector("#download");if(!g)throw new Error("Some elements are not exist");g.style.opacity="0";const _=r=>{g.href=URL.createObjectURL(r),g.download="acetest.wav",g.style.opacity="1"},J=()=>{g.href="",g.style.opacity="0"},T=r=>{navigator.mediaDevices.enumerateDevices().then(o=>{for(let e=0;e!==o.length;++e){const a=o[e],i=document.createElement("option");i.value=a.deviceId,a.kind==="audioinput"&&(i.text=a.label||`Microphone ${e}`,r.append(i))}}).catch(()=>{alert("error get devices")})};function Z(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var M={exports:{}},x,I;function G(){if(I)return x;I=1;var r=1e3,o=r*60,e=o*60,a=e*24,i=a*7,c=a*365.25;x=function(t,n){n=n||{};var s=typeof t;if(s==="string"&&t.length>0)return d(t);if(s==="number"&&isFinite(t))return n.long?u(t):y(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function d(t){if(t=String(t),!(t.length>100)){var n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(n){var s=parseFloat(n[1]),h=(n[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return s*c;case"weeks":case"week":case"w":return s*i;case"days":case"day":case"d":return s*a;case"hours":case"hour":case"hrs":case"hr":case"h":return s*e;case"minutes":case"minute":case"mins":case"min":case"m":return s*o;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}function y(t){var n=Math.abs(t);return n>=a?Math.round(t/a)+"d":n>=e?Math.round(t/e)+"h":n>=o?Math.round(t/o)+"m":n>=r?Math.round(t/r)+"s":t+"ms"}function u(t){var n=Math.abs(t);return n>=a?l(t,n,a,"day"):n>=e?l(t,n,e,"hour"):n>=o?l(t,n,o,"minute"):n>=r?l(t,n,r,"second"):t+" ms"}function l(t,n,s,h){var F=n>=s*1.5;return Math.round(t/s)+" "+h+(F?"s":"")}return x}function K(r){e.debug=e,e.default=e,e.coerce=u,e.disable=c,e.enable=i,e.enabled=d,e.humanize=G(),e.destroy=l,Object.keys(r).forEach(t=>{e[t]=r[t]}),e.names=[],e.skips=[],e.formatters={};function o(t){let n=0;for(let s=0;s<t.length;s++)n=(n<<5)-n+t.charCodeAt(s),n|=0;return e.colors[Math.abs(n)%e.colors.length]}e.selectColor=o;function e(t){let n,s=null,h,F;function C(...f){if(!C.enabled)return;const m=C,w=Number(new Date),P=w-(n||w);m.diff=P,m.prev=n,m.curr=w,n=w,f[0]=e.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let b=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,(E,$)=>{if(E==="%%")return"%";b++;const N=e.formatters[$];if(typeof N=="function"){const B=f[b];E=N.call(m,B),f.splice(b,1),b--}return E}),e.formatArgs.call(m,f),(m.log||e.log).apply(m,f)}return C.namespace=t,C.useColors=e.useColors(),C.color=e.selectColor(t),C.extend=a,C.destroy=e.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>s!==null?s:(h!==e.namespaces&&(h=e.namespaces,F=e.enabled(t)),F),set:f=>{s=f}}),typeof e.init=="function"&&e.init(C),C}function a(t,n){const s=e(this.namespace+(typeof n>"u"?":":n)+t);return s.log=this.log,s}function i(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let n;const s=(typeof t=="string"?t:"").split(/[\s,]+/),h=s.length;for(n=0;n<h;n++)s[n]&&(t=s[n].replace(/\*/g,".*?"),t[0]==="-"?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function c(){const t=[...e.names.map(y),...e.skips.map(y).map(n=>"-"+n)].join(",");return e.enable(""),t}function d(t){if(t[t.length-1]==="*")return!0;let n,s;for(n=0,s=e.skips.length;n<s;n++)if(e.skips[n].test(t))return!1;for(n=0,s=e.names.length;n<s;n++)if(e.names[n].test(t))return!0;return!1}function y(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}function u(t){return t instanceof Error?t.stack||t.message:t}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var H=K;(function(r,o){o.formatArgs=a,o.save=i,o.load=c,o.useColors=e,o.storage=d(),o.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),o.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let t=0,n=0;u[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),u.splice(n,0,l)}o.log=console.debug||console.log||(()=>{});function i(u){try{u?o.storage.setItem("debug",u):o.storage.removeItem("debug")}catch{}}function c(){let u;try{u=o.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u={}.DEBUG),u}function d(){try{return localStorage}catch{}}r.exports=H(o);const{formatters:y}=r.exports;y.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(M,M.exports);var Q=M.exports;const q=Z(Q),R="@vinteo/noise-suppression",v=q(R),V=()=>{q.enable(`${R}`)};class X{constructor(o){p(this,"audioContext");p(this,"audioSource");p(this,"audioDestination");p(this,"noiseSuppressorNode");p(this,"workletUrl");p(this,"startEffect",o=>{v("startEffect");const e=new AudioContext;this.audioContext=e;const a=e.createMediaStreamSource(new MediaStream([o]));this.audioSource=a;const i=e.createMediaStreamDestination();this.audioDestination=i;const c=this.audioDestination.stream.getAudioTracks()[0];return e.audioWorklet.addModule(this.workletUrl).then(()=>{this.noiseSuppressorNode=new AudioWorkletNode(e,"NoiseSuppressorWorklet"),a.connect(this.noiseSuppressorNode).connect(i)}).then(()=>{v("Success!!!")}).catch(d=>{v("Error while adding audio worklet module: ",d)}),o.enabled=!0,c});p(this,"stopEffect",async()=>{var o,e,a,i,c;v("stopEffect"),(o=this.noiseSuppressorNode)==null||o.port.close(),(e=this.audioDestination)==null||e.disconnect(),(a=this.noiseSuppressorNode)==null||a.disconnect(),(i=this.audioSource)==null||i.disconnect(),await((c=this.audioContext)==null?void 0:c.close()),delete this.noiseSuppressorNode,delete this.audioDestination,delete this.audioSource,delete this.audioContext});this.workletUrl=o}}V();const Y="@vinteo/noise-suppression/noiseSuppressorWorklet.es.js?url",A=new X(Y),ee=async r=>(await A.stopEffect(),A.startEffect(r)),te=async()=>A.stopEffect(),oe=(r,o)=>{const e=new MediaStream([r]),a={mimeType:"audio/webm"},i=[],c=new MediaRecorder(e,a);return c.addEventListener("dataavailable",d=>{d.data.size>0&&i.push(d.data)}),c.addEventListener("stop",()=>{o(new Blob(i))}),c.start(),()=>{c.stop()}},L=document.querySelector("#audioInputSelect"),S=document.querySelector("#stop"),k=document.querySelector("#start"),U=document.querySelector("#rnnoise"),ne=new j("echoCancellation"),re=new j("noiseSuppression");if(!L||!S||!k||!U)throw new Error("Some elements are not exist");const se=()=>{S.disabled=!1,k.disabled=!0},D=()=>{S.disabled=!0,k.disabled=!1},ie=()=>{se(),J();const r=L.value;navigator.mediaDevices.getUserMedia({audio:{deviceId:r,echoCancellation:ne.checked,noiseSuppression:re.checked}}).then(o=>o.getAudioTracks()[0]).then(async o=>U.checked?ee(o):o).then(o=>{const e=oe(o,_);S.addEventListener("click",()=>{e(),te().catch(console.error),D()})}).catch(o=>{console.log("ðŸš€ ~ file: demo.js:34 ~ start ~ error:",o),alert(o),D()})};T(L);D();k.addEventListener("click",ie);
