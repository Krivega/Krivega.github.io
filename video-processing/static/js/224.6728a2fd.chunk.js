(globalThis.webpackChunkvideo_processing=globalThis.webpackChunkvideo_processing||[]).push([[224],{9317:(t,e,n)=>{"use strict";n.d(e,{EK:()=>h,Ju:()=>c,WS:()=>r,Xr:()=>u,fw:()=>o,vL:()=>i});const i=(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},o=function(t){let{type:e="2d",imageSmoothingQuality:n,globalCompositeOperation:i,alpha:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t.getContext(e,{alpha:o,desynchronized:!0,willReadFrequently:!0});n&&(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality=n),i&&(r.globalCompositeOperation=i);return r},r=(t,e)=>new OffscreenCanvas(t,e),a=t=>{const{height:e,width:n}=t;return{height:e,width:n}},u=(t,e)=>{o(e).putImageData(t,0,0)},s=function(t,e){let{x:n=0,y:i=0,width:r,height:u,imageSmoothingQuality:s,alpha:c,globalCompositeOperation:h}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=a(t),f=r||l.width,g=u||l.height,d=o(e,{imageSmoothingQuality:s,alpha:c,globalCompositeOperation:h});d.drawImage(t,n,i,f,g)},c=(t,e,n,i,o)=>{t.globalCompositeOperation=n;const{width:r,height:a}=e;t.drawImage(e,0,0,r,a,0,0,i,o)},h=t=>{let{canvas:e,image:n}=t;return s(n,e),e.transferToImageBitmap()}},3998:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(4855),o=n.n(i);const r=()=>{let t,e=!1,n=!0;return{init:()=>{e=!1,n=!0,t=new(o()),t.showPanel(0),document.body.appendChild(t.dom)},begin:()=>{t&&n&&!e&&(n=!1,e=!0,t.begin())},end:()=>{t&&e&&!n&&(n=!0,e=!1,t.end())},reset:()=>{document.body.removeChild(t.dom),t=void 0}}}},8446:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i=t=>{const e=document.createElement("video");return e.srcObject=t,new Promise((t=>{e.onloadedmetadata=()=>{e.width=e.videoWidth,e.height=e.videoHeight,e.play(),t(e)}}))}},3707:function(t,e,n){(function(){"use strict";function t(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var i=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var e=0;e<t.length;++e){var i=t[e];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")}(this);function o(t,n){if(n)t:{var o=i;t=t.split(".");for(var r=0;r<t.length-1;r++){var a=t[r];if(!(a in o))break t;o=o[a]}(n=n(r=o[t=t[t.length-1]]))!=r&&null!=n&&e(o,t,{configurable:!0,writable:!0,value:n})}}function r(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function a(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function u(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function s(t){if(t.i)throw new TypeError("Generator is already running");t.i=!0}function c(t,e){t.h={F:e,G:!0},t.j=t.m}function h(t){this.g=new u,this.h=t}function l(t,e,n,i){try{var o=e.call(t.g.g,n);if(!(o instanceof Object))throw new TypeError("Iterator result "+o+" is not an object");if(!o.done)return t.g.i=!1,o;var r=o.value}catch(a){return t.g.g=null,c(t.g,a),f(t)}return t.g.g=null,i.call(t.g,r),f(t)}function f(t){for(;t.g.j;)try{var e=t.h(t.g);if(e)return t.g.i=!1,{value:e.value,done:!1}}catch(n){t.g.o=void 0,c(t.g,n)}if(t.g.i=!1,t.g.h){if(e=t.g.h,t.g.h=null,e.G)throw e.F;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function g(t){this.next=function(e){return s(t.g),t.g.g?e=l(t,t.g.g.next,e,t.g.l):(t.g.l(e),e=f(t)),e},this.throw=function(e){return s(t.g),t.g.g?e=l(t,t.g.g.throw,e,t.g.l):(c(t.g,e),e=f(t)),e},this.return=function(e){return function(t,e){s(t.g);var n=t.g.g;return n?l(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),f(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function d(t){function e(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise((function(i,o){!function t(r){r.done?i(r.value):Promise.resolve(r.value).then(e,n).then(t,o)}(t.next())}))}o("Symbol",(function(t){function n(t,n){this.g=t,e(this,"description",{configurable:!0,writable:!0,value:n})}if(t)return t;n.prototype.toString=function(){return this.g};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",o=0;return function t(e){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(i+(e||"")+"_"+o++,e)}})),o("Symbol.iterator",(function(n){if(n)return n;n=Symbol("Symbol.iterator");for(var o="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<o.length;a++){var u=i[o[a]];"function"===typeof u&&"function"!=typeof u.prototype[n]&&e(u.prototype,n,{configurable:!0,writable:!0,value:function(){return r(t(this))}})}return n})),u.prototype.l=function(t){this.o=t},u.prototype.return=function(t){this.h={return:t},this.j=this.m},o("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function n(){this.g=null}function o(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var r=i.setTimeout;n.prototype.i=function(t){r(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(i){this.j(i)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(i){n||(n=!0,t.call(e,i))}}var e=this,n=!1;return{resolve:t(this.A),reject:t(this.l)}},e.prototype.A=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.C(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.v(t):this.m(t)}},e.prototype.v=function(t){var e=void 0;try{e=t.then}catch(n){return void this.l(n)}"function"==typeof e?this.D(e,t):this.m(t)},e.prototype.l=function(t){this.u(2,t)},e.prototype.m=function(t){this.u(1,t)},e.prototype.u=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.B(),this.H()},e.prototype.B=function(){var t=this;r((function(){if(t.I()){var e=i.console;"undefined"!==typeof e&&e.error(t.i)}}),1)},e.prototype.I=function(){if(this.o)return!1;var t=i.CustomEvent,e=i.Event,n=i.dispatchEvent;return"undefined"===typeof n||("function"===typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"===typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.H=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)u.h(this.g[t]);this.g=null}};var u=new n;return e.prototype.C=function(t){var e=this.j();t.s(e.resolve,e.reject)},e.prototype.D=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(i){n.reject(i)}},e.prototype.then=function(t,n){function i(t,e){return"function"==typeof t?function(e){try{o(t(e))}catch(n){r(n)}}:e}var o,r,a=new e((function(t,e){o=t,r=e}));return this.s(i(t,o),i(n,r)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.s=function(t,e){function n(){switch(i.h){case 1:t(i.i);break;case 2:e(i.i);break;default:throw Error("Unexpected state: "+i.h)}}var i=this;null==this.g?u.h(n):this.g.push(n),this.o=!0},e.resolve=o,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var i=a(t),r=i.next();!r.done;r=i.next())o(r.value).s(e,n)}))},e.all=function(t){var n=a(t),i=n.next();return i.done?o([]):new e((function(t,e){function r(e){return function(n){a[e]=n,0==--u&&t(a)}}var a=[],u=0;do{a.push(void 0),u++,o(i.value).s(r(a.length-1),e),i=n.next()}while(!i.done)}))},e}));var p="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t};o("Object.assign",(function(t){return t||p}));var v=this||self,m={facingMode:"user",width:640,height:480};function y(t,e){this.video=t,this.i=0,this.h=Object.assign(Object.assign({},m),e)}function w(t){window.requestAnimationFrame((function(){!function(t){var e=null;t.video.paused||t.video.currentTime===t.i||(t.i=t.video.currentTime,e=t.h.onFrame()),e?e.then((function(){w(t)})):w(t)}(t)}))}y.prototype.stop=function(){var t,e,n,i=this;return d(new g(new h((function(o){if(i.g){for(t=i.g.getTracks(),e=a(t),n=e.next();!n.done;n=e.next())n.value.stop();i.g=void 0}o.j=0}))))},y.prototype.start=function(){var t,e=this;return d(new g(new h((function(n){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),t=e.h,n.return(navigator.mediaDevices.getUserMedia({video:{facingMode:t.facingMode,width:t.width,height:t.height}}).then((function(t){!function(t,e){t.g=e,t.video.srcObject=e,t.video.onloadedmetadata=function(){t.video.play(),w(t)}}(e,t)})).catch((function(t){var e="Failed to acquire camera feed: "+t;throw console.error(e),alert(e),t})))}))))};var b,j=["Camera"],S=v;j[0]in S||"undefined"==typeof S.execScript||S.execScript("var "+j[0]);for(;j.length&&(b=j.shift());)j.length||void 0===y?S=S[b]&&S[b]!==Object.prototype[b]?S[b]:S[b]={}:S[b]=y}).call(this)},1238:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var i=n(9317);const o=t=>{let{videoSource:e,canvas:n,imageMask:o,personMask:r,edgeBlurAmount:a}=t;const{width:u,height:s}=e,c=(0,i.fw)(n);r?(c.save(),c.drawImage(e,0,0),a>0&&(c.filter=`blur(${a}px)`),(0,i.Ju)(c,r,"destination-in",u,s),c.filter="none",(0,i.Ju)(c,o,"destination-over",u,s),c.restore()):c.drawImage(e,0,0)}},3224:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var i=n(3707),o=n(8741),r=n(3998),a=n(8446),u=n(9317),s=n(1238);const c=t=>{let{imageBitmapMask360p:e,imageBitmapMask720p:n,imageBitmapMask1080p:c}=t;const h=new o.SelfieSegmentation({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${t}`}),l=(0,r.Z)();let f,g;const d=t=>{let{modelSelection:o,edgeBlurAmount:r}=t;const{width:a,height:u}=f;let d;switch(l.init(),a){case 640:d=e;break;case 1280:d=n;break;case 1920:d=c}h.setOptions({modelSelection:"general"===o?0:1}),h.onResults((t=>{(0,s.Z)({edgeBlurAmount:r,personMask:t.segmentationMask,imageMask:d,canvas:g,videoSource:t.image}),l.end()}));new i.Camera(f,{onFrame:async()=>{l.begin(),await h.send({image:f})},width:a,height:u}).start()},p=t=>{let{mediaStream:e,modelSelection:n,edgeBlurAmount:i}=t;return(t=>(0,a.Z)(t).then((t=>(f=t,f))))(e).then((()=>{const{width:t,height:e}=f;g=(0,u.vL)(t,e),d({modelSelection:n,edgeBlurAmount:i});return g.captureStream()}))},v=()=>(l.reset(),Promise.resolve()),m=()=>v().then((()=>{f&&(f.srcObject=null)}));return{start:p,restart:t=>{let{mediaStream:e,modelSelection:n,edgeBlurAmount:i}=t;return m().then((()=>p({mediaStream:e,modelSelection:n,edgeBlurAmount:i})))},changeParams:t=>{let{modelSelection:e,edgeBlurAmount:n}=t;return v().then((()=>{})).then((()=>d({modelSelection:e,edgeBlurAmount:n})))},stop:m}}}}]);
//# sourceMappingURL=224.6728a2fd.chunk.js.map