/*! For license information please see 528.56515651.chunk.js.LICENSE.txt */
(globalThis.webpackChunkvideo_processing=globalThis.webpackChunkvideo_processing||[]).push([[528],{4200:(t,e,n)=>{"use strict";function i(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))}n.d(e,{Z:()=>u});let r=0,o=0;const a=[];let s=!document||!document.hidden;class u{constructor(){let{backgroundThrottling:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{backgroundThrottling:!0};this.active=!0,this.runner=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=()=>t||s,n=new Map,i=t=>{n.delete(t)};return document.addEventListener("visibilitychange",(()=>{s=!document||!document.hidden,e()||n.forEach(((t,e)=>{t(),i(e)}))})),{requestAnimationFrame:t=>e()?window.requestAnimationFrame(t):(t=>{if(0===a.length){const t=performance.now(),e=Math.max(0,16.666666666666668-(t-r));r=e+t,setTimeout((()=>{const t=a.slice(0);a.length=0;for(let e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(r)}catch(t){setTimeout((()=>{throw t}),0)}}),Math.round(e))}return o+=1,a.push({handle:o,cancelled:!1,callback:t}),o})(t),cancelAnimationFrame:t=>{window.cancelAnimationFrame(t),(t=>{for(let e=0;e<a.length;e++)a[e].handle===t&&(a[e].cancelled=!0)})(t)},whenRestarted:(t,e)=>{n.set(t,e)},offRestart:i}}(t)}run(t){const e=1e3/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:60);let n=0;const i=r=>{this.request(i);const o=r-n;o>e&&(n=r-o%e,t(r))};this.cancelRequest(),this.request(i)}runAsync(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;return i(this,void 0,void 0,(function*(){const n=1e3/e;let r=0;const o=e=>i(this,void 0,void 0,(function*(){const i=e-r;i>n&&(r=e-i%n,yield t(e)),this.request(o)}));this.cancelRequest(),this.request(o)}))}request(t){this.requestID&&this.runner.offRestart(this.requestID),this.active&&(this.requestID=this.runner.requestAnimationFrame(t),this.runner.whenRestarted(this.requestID,(()=>{this.cancelRequest(),this.requestID=this.runner.requestAnimationFrame(t)})))}cancelRequest(){this.requestID&&(this.runner.cancelAnimationFrame(this.requestID),this.runner.offRestart(this.requestID))}activate(){this.cancelRequest(),this.active=!0}deactivate(){this.cancelRequest(),this.active=!1}}},9317:(t,e,n)=>{"use strict";n.d(e,{EK:()=>l,Ju:()=>c,WS:()=>o,Xr:()=>s,fw:()=>r,vL:()=>i});const i=(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},r=function(t){let{type:e="2d",imageSmoothingQuality:n,globalCompositeOperation:i,alpha:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=t.getContext(e,{alpha:r,desynchronized:!0,willReadFrequently:!0});n&&(o.imageSmoothingEnabled=!0,o.imageSmoothingQuality=n),i&&(o.globalCompositeOperation=i);return o},o=(t,e)=>new OffscreenCanvas(t,e),a=t=>{const{height:e,width:n}=t;return{height:e,width:n}},s=(t,e)=>{r(e).putImageData(t,0,0)},u=function(t,e){let{x:n=0,y:i=0,width:o,height:s,imageSmoothingQuality:u,alpha:c,globalCompositeOperation:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const h=a(t),d=o||h.width,f=s||h.height,g=r(e,{imageSmoothingQuality:u,alpha:c,globalCompositeOperation:l});g.drawImage(t,n,i,d,f)},c=(t,e,n,i,r)=>{t.globalCompositeOperation=n;const{width:o,height:a}=e;t.drawImage(e,0,0,o,a,0,0,i,r)},l=t=>{let{canvas:e,image:n}=t;return u(n,e),e.transferToImageBitmap()}},3998:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var i=n(4855),r=n.n(i);const o=()=>{let t,e=!1,n=!0;return{init:()=>{e=!1,n=!0,t=new(r()),t.showPanel(0),document.body.appendChild(t.dom)},begin:()=>{t&&n&&!e&&(n=!1,e=!0,t.begin())},end:()=>{t&&e&&!n&&(n=!0,e=!1,t.end())},reset:()=>{document.body.removeChild(t.dom),t=void 0}}}},8446:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i=t=>{const e=document.createElement("video");return e.srcObject=t,new Promise((t=>{e.onloadedmetadata=()=>{e.width=e.videoWidth,e.height=e.videoHeight,e.play(),t(e)}}))}},3707:function(t,e,n){(function(){"use strict";function t(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var i=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var e=0;e<t.length;++e){var i=t[e];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")}(this);function r(t,n){if(n)t:{var r=i;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];if(!(a in r))break t;r=r[a]}(n=n(o=r[t=t[t.length-1]]))!=o&&null!=n&&e(r,t,{configurable:!0,writable:!0,value:n})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function a(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function s(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function u(t){if(t.i)throw new TypeError("Generator is already running");t.i=!0}function c(t,e){t.h={F:e,G:!0},t.j=t.m}function l(t){this.g=new s,this.h=t}function h(t,e,n,i){try{var r=e.call(t.g.g,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return t.g.i=!1,r;var o=r.value}catch(a){return t.g.g=null,c(t.g,a),d(t)}return t.g.g=null,i.call(t.g,o),d(t)}function d(t){for(;t.g.j;)try{var e=t.h(t.g);if(e)return t.g.i=!1,{value:e.value,done:!1}}catch(n){t.g.o=void 0,c(t.g,n)}if(t.g.i=!1,t.g.h){if(e=t.g.h,t.g.h=null,e.G)throw e.F;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function f(t){this.next=function(e){return u(t.g),t.g.g?e=h(t,t.g.g.next,e,t.g.l):(t.g.l(e),e=d(t)),e},this.throw=function(e){return u(t.g),t.g.g?e=h(t,t.g.g.throw,e,t.g.l):(c(t.g,e),e=d(t)),e},this.return=function(e){return function(t,e){u(t.g);var n=t.g.g;return n?h(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),d(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function g(t){function e(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise((function(i,r){!function t(o){o.done?i(o.value):Promise.resolve(o.value).then(e,n).then(t,r)}(t.next())}))}r("Symbol",(function(t){function n(t,n){this.g=t,e(this,"description",{configurable:!0,writable:!0,value:n})}if(t)return t;n.prototype.toString=function(){return this.g};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function t(e){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(i+(e||"")+"_"+r++,e)}})),r("Symbol.iterator",(function(n){if(n)return n;n=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<r.length;a++){var s=i[r[a]];"function"===typeof s&&"function"!=typeof s.prototype[n]&&e(s.prototype,n,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return n})),s.prototype.l=function(t){this.o=t},s.prototype.return=function(t){this.h={return:t},this.j=this.m},r("Promise",(function(t){function e(t){this.h=0,this.i=void 0,this.g=[],this.o=!1;var e=this.j();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function n(){this.g=null}function r(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;n.prototype.h=function(t){if(null==this.g){this.g=[];var e=this;this.i((function(){e.l()}))}this.g.push(t)};var o=i.setTimeout;n.prototype.i=function(t){o(t,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var t=this.g;this.g=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(i){this.j(i)}}}this.g=null},n.prototype.j=function(t){this.i((function(){throw t}))},e.prototype.j=function(){function t(t){return function(i){n||(n=!0,t.call(e,i))}}var e=this,n=!1;return{resolve:t(this.A),reject:t(this.l)}},e.prototype.A=function(t){if(t===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.C(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.v(t):this.m(t)}},e.prototype.v=function(t){var e=void 0;try{e=t.then}catch(n){return void this.l(n)}"function"==typeof e?this.D(e,t):this.m(t)},e.prototype.l=function(t){this.u(2,t)},e.prototype.m=function(t){this.u(1,t)},e.prototype.u=function(t,e){if(0!=this.h)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.h);this.h=t,this.i=e,2===this.h&&this.B(),this.H()},e.prototype.B=function(){var t=this;o((function(){if(t.I()){var e=i.console;"undefined"!==typeof e&&e.error(t.i)}}),1)},e.prototype.I=function(){if(this.o)return!1;var t=i.CustomEvent,e=i.Event,n=i.dispatchEvent;return"undefined"===typeof n||("function"===typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"===typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.i,n(t))},e.prototype.H=function(){if(null!=this.g){for(var t=0;t<this.g.length;++t)s.h(this.g[t]);this.g=null}};var s=new n;return e.prototype.C=function(t){var e=this.j();t.s(e.resolve,e.reject)},e.prototype.D=function(t,e){var n=this.j();try{t.call(e,n.resolve,n.reject)}catch(i){n.reject(i)}},e.prototype.then=function(t,n){function i(t,e){return"function"==typeof t?function(e){try{r(t(e))}catch(n){o(n)}}:e}var r,o,a=new e((function(t,e){r=t,o=e}));return this.s(i(t,r),i(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.s=function(t,e){function n(){switch(i.h){case 1:t(i.i);break;case 2:e(i.i);break;default:throw Error("Unexpected state: "+i.h)}}var i=this;null==this.g?s.h(n):this.g.push(n),this.o=!0},e.resolve=r,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var i=a(t),o=i.next();!o.done;o=i.next())r(o.value).s(e,n)}))},e.all=function(t){var n=a(t),i=n.next();return i.done?r([]):new e((function(t,e){function o(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).s(o(a.length-1),e),i=n.next()}while(!i.done)}))},e}));var v="function"==typeof Object.assign?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t};r("Object.assign",(function(t){return t||v}));var m=this||self,p={facingMode:"user",width:640,height:480};function y(t,e){this.video=t,this.i=0,this.h=Object.assign(Object.assign({},p),e)}function w(t){window.requestAnimationFrame((function(){!function(t){var e=null;t.video.paused||t.video.currentTime===t.i||(t.i=t.video.currentTime,e=t.h.onFrame()),e?e.then((function(){w(t)})):w(t)}(t)}))}y.prototype.stop=function(){var t,e,n,i=this;return g(new f(new l((function(r){if(i.g){for(t=i.g.getTracks(),e=a(t),n=e.next();!n.done;n=e.next())n.value.stop();i.g=void 0}r.j=0}))))},y.prototype.start=function(){var t,e=this;return g(new f(new l((function(n){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),t=e.h,n.return(navigator.mediaDevices.getUserMedia({video:{facingMode:t.facingMode,width:t.width,height:t.height}}).then((function(t){!function(t,e){t.g=e,t.video.srcObject=e,t.video.onloadedmetadata=function(){t.video.play(),w(t)}}(e,t)})).catch((function(t){var e="Failed to acquire camera feed: "+t;throw console.error(e),alert(e),t})))}))))};var b,j=["Camera"],k=m;j[0]in k||"undefined"==typeof k.execScript||k.execScript("var "+j[0]);for(;j.length&&(b=j.shift());)j.length||void 0===y?k=k[b]&&k[b]!==Object.prototype[b]?k[b]:k[b]={}:k[b]=y}).call(this)},6327:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(9317);const r=t=>{let{videoSource:e,canvas:n,imageMask:r,personMask:o,edgeBlurAmount:a}=t;const{width:s,height:u}=e,c=(0,i.fw)(n);c.save(),c.drawImage(e,0,0),a>0&&(c.filter=`blur(${a}px)`),(0,i.Ju)(c,o,"destination-in",s,u),c.filter="none",(0,i.Ju)(c,r,"destination-over",s,u),c.restore()},o=t=>{let{videoSource:e,canvas:n,personMask:r,edgeBlurAmount:o}=t;const{width:a,height:s}=e,u=(0,i.fw)(n);u.save(),u.drawImage(e,0,0),(0,i.Ju)(u,r,"destination-in",a,s),u.filter=`blur(${o}px)`,(0,i.Ju)(u,e,"destination-over",a,s),u.filter="none",u.restore()},a=t=>{let{videoSource:e,canvas:n,imageMask:a,personMask:s,edgeBlurAmount:u,isBlurBackground:c}=t;if(s)c?o({videoSource:e,canvas:n,personMask:s,edgeBlurAmount:u}):r({videoSource:e,canvas:n,imageMask:a,personMask:s,edgeBlurAmount:u});else{(0,i.fw)(n).drawImage(e,0,0)}}},3528:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>h});var i=n(4200),r=n(3707),o=n(8741),a=n(3998);const s=()=>({sampleSize:60,value:0,_sample_:[],_index_:0,_lastTick_:0,tick(){if(!this._lastTick_)return this._lastTick_=performance.now(),0;const t=performance.now(),e=1/((t-this._lastTick_)/1e3);this._sample_[this._index_]=Math.round(e);let n=0;for(let i=0;i<this._sample_.length;i++)n+=this._sample_[i];return n=Math.round(n/this._sample_.length),this.value=n,this._lastTick_=t,this._index_+=1,this._index_===this.sampleSize&&(this._index_=0),this.value}});var u=n(8446),c=n(9317),l=n(6327);const h=t=>{let{imageBitmapMask360p:e,imageBitmapMask720p:n,imageBitmapMask1080p:h}=t;return(()=>{const t=new o.SelfieSegmentation({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${t}`});return t.initialize().then((()=>t))})().then((t=>{const o=(0,a.Z)(),d=s(),f=new i.Z;let g,v;const m=i=>{let{modelSelection:a,edgeBlurAmount:s,isBlurBackground:u}=i;const{width:c,height:m}=g,p=(t=>{switch(t){case 640:return e;case 1280:return n}return h})(c);let y;o.init();t.setOptions({modelSelection:"general"===a?0:1}),t.onResults((t=>{y=t.segmentationMask,(0,l.Z)({edgeBlurAmount:s,personMask:y,videoSource:g,isBlurBackground:u,imageMask:p,canvas:v}),o.end(),d.tick()}));new r.Camera(g,{onFrame:async()=>{o.begin(),await t.send({image:g})},width:c,height:m}).start(),f.activate(),f.run((()=>{d.value<60&&y&&console.log("\ud83d\ude80 ~ file: index.ts ~ line 117 ~ animationRequest.run ~ targetVideoFrame",d.value)}),60)},p=t=>{let{mediaStream:e,modelSelection:n,edgeBlurAmount:i,isBlurBackground:r}=t;return(t=>(0,u.Z)(t).then((t=>(g=t,g))))(e).then((()=>{const{width:t,height:e}=g;v=(0,c.vL)(t,e),m({modelSelection:n,edgeBlurAmount:i,isBlurBackground:r});return v.captureStream()}))},y=()=>(f.deactivate(),o.reset(),new Promise((t=>{t()}))),w=()=>y().then((()=>{g&&(g.srcObject=null)}));return{start:p,restart:t=>{let{mediaStream:e,modelSelection:n,edgeBlurAmount:i,isBlurBackground:r}=t;return w().then((()=>p({mediaStream:e,modelSelection:n,edgeBlurAmount:i,isBlurBackground:r})))},changeParams:t=>{let{modelSelection:e,edgeBlurAmount:n,isBlurBackground:i}=t;return y().then((()=>{})).then((()=>m({modelSelection:e,edgeBlurAmount:n,isBlurBackground:i})))},stop:w}}))}}}]);
//# sourceMappingURL=528.56515651.chunk.js.map