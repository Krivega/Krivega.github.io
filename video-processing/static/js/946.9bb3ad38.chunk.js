(globalThis.webpackChunkvideo_processing=globalThis.webpackChunkvideo_processing||[]).push([[946],{9317:(e,t,n)=>{"use strict";n.d(t,{EK:()=>m,Ju:()=>d,WS:()=>i,Xr:()=>l,fw:()=>o,vL:()=>a});const a=(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},o=function(e){let{type:t="2d",imageSmoothingQuality:n,globalCompositeOperation:a,alpha:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.getContext(t,{alpha:o,desynchronized:!0,willReadFrequently:!0});n&&(i.imageSmoothingEnabled=!0,i.imageSmoothingQuality=n),a&&(i.globalCompositeOperation=a);return i},i=(e,t)=>new OffscreenCanvas(e,t),r=e=>{const{height:t,width:n}=e;return{height:t,width:n}},l=(e,t)=>{o(t).putImageData(e,0,0)},s=function(e,t){let{x:n=0,y:a=0,width:i,height:l,imageSmoothingQuality:s,alpha:d,globalCompositeOperation:m}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const u=r(e),c=i||u.width,g=l||u.height,h=o(t,{imageSmoothingQuality:s,alpha:d,globalCompositeOperation:m});h.drawImage(e,n,a,c,g)},d=(e,t,n,a,o)=>{e.globalCompositeOperation=n;const{width:i,height:r}=t;e.drawImage(t,0,0,i,r,0,0,a,o)},m=e=>{let{canvas:t,image:n}=e;return s(n,t),t.transferToImageBitmap()}},3998:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var a=n(4855),o=n.n(a);const i=()=>{let e,t=!1,n=!0;return{init:()=>{t=!1,n=!0,e=new(o()),e.showPanel(0),document.body.appendChild(e.dom)},begin:()=>{e&&n&&!t&&(n=!1,t=!0,e.begin())},end:()=>{e&&t&&!n&&(n=!0,t=!1,e.end())},reset:()=>{document.body.removeChild(e.dom),e=void 0}}}},8446:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});const a=e=>{const t=document.createElement("video");return t.srcObject=e,new Promise((e=>{t.onloadedmetadata=()=>{t.width=t.videoWidth,t.height=t.videoHeight,t.play(),e(t)}}))}},5483:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var a=n(4200),o=n(3998),i=n(8446),r=n(9317);const l=e=>{let{videoSource:t,canvas:n,imageMask:a,personMask:o,edgeBlurAmount:i}=e;const{width:l,height:s}=t,d=(0,r.fw)(n);o?(d.save(),d.drawImage(t,0,0),i>0&&(d.filter=`blur(${i}px)`),(0,r.Ju)(d,o,"destination-out",l,s),d.filter="none",(0,r.Ju)(d,a,"destination-over",l,s),d.restore()):d.drawImage(t,0,0)};n(37),n(5439);var s=n(1627);n(1393);let d={};const m=()=>{d={}},u=async e=>{const t=await s.wX(e,{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255},!0,.6),{width:n,height:a}=t,o=((e,t,n)=>{const a=`${e}_${t}_${n}`;return d[a]||(d[a]=(0,r.WS)(t,n)),d[a]})("blurredMask",n,a);return(0,r.Xr)(t,o),o.transferToImageBitmap()},c=async(e,t)=>{let{imageBitmap:n}=t;const a=await e.segmentPeople(n);if(Array.isArray(a)&&0===a.length)return;return u(a)},g=()=>{const e={},t=(t,n)=>{e[t]=n};return{getStateValue:t=>e[t],getState:()=>e,setStateValue:t,initState:e=>{let{modelSelection:n}=e;t("modelSelection",n)}}},{getState:h,initState:p,setStateValue:S}=g();let w;const B=s.oV.MediaPipeSelfieSegmentation,v=async e=>{let{modelSelection:t}=e;const n={runtime:"tfjs",modelType:t};w=await s.N7(B,n)},b=e=>{let{modelSelection:t}=e;return p({modelSelection:t}),m(),v({modelSelection:t})},k=e=>c(w,{imageBitmap:e}),y=e=>{let{modelSelection:t}=e;return S("modelSelection",t),m(),v({modelSelection:t})},f=e=>{let{imageBitmapMask360p:t,imageBitmapMask720p:n,imageBitmapMask1080p:s}=e;const d=(0,o.Z)(),m=new a.Z;let u,c,g,h=!1;let p=!1;const S=e=>{let{edgeBlurAmount:a,isBlurBackground:o}=e;const{width:i,height:S}=c,w=(0,r.WS)(i,S),B=(e=>{switch(e){case 640:return t;case 1280:return n}return s})(i);let v,b=(0,r.EK)({image:c,canvas:w});d.init(),h=!0;const y=async()=>{d.begin(),p=!0,h&&(v=await k(b)),d.end(),p=!1,h&&(u=requestAnimationFrame(y))},f=()=>{b=(0,r.EK)({image:c,canvas:w}),l({personMask:v,edgeBlurAmount:a,videoSource:c,imageMask:B,canvas:g})};y().then((()=>{m.activate(),m.run(f,24)}))},w=e=>{let{mediaStream:t,modelSelection:n,edgeBlurAmount:a,isBlurBackground:o}=e;return b({modelSelection:n}).then((()=>(e=>(0,i.Z)(e).then((e=>(c=e,c))))(t))).then((()=>{const{width:e,height:t}=c;g=(0,r.vL)(e,t),S({edgeBlurAmount:a,isBlurBackground:o});return g.captureStream()}))},B=()=>(h=!1,window.cancelAnimationFrame(u),m.deactivate(),d.reset(),new Promise((e=>{const t=()=>{!1===p?e():setTimeout(t,100)};t()}))),v=()=>B().then((()=>{c&&(c.srcObject=null)}));return Promise.resolve({start:w,restart:e=>{let{mediaStream:t,modelSelection:n,isBlurBackground:a,edgeBlurAmount:o}=e;return v().then((()=>w({mediaStream:t,modelSelection:n,edgeBlurAmount:o,isBlurBackground:a})))},changeParams:e=>{let{modelSelection:t,edgeBlurAmount:n,isBlurBackground:a}=e;return B().then((()=>y({modelSelection:t}))).then((()=>S({edgeBlurAmount:n,isBlurBackground:a})))},stop:v})}},7890:()=>{},134:()=>{},9797:()=>{}}]);
//# sourceMappingURL=946.9bb3ad38.chunk.js.map