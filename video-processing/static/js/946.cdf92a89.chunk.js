(globalThis.webpackChunkvideo_processing=globalThis.webpackChunkvideo_processing||[]).push([[946],{9317:(e,t,n)=>{"use strict";n.d(t,{EK:()=>d,Ju:()=>m,WS:()=>o,Xr:()=>l,fw:()=>i,vL:()=>a});const a=(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,n},i=function(e){let{type:t="2d",imageSmoothingQuality:n,globalCompositeOperation:a,alpha:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=e.getContext(t,{alpha:i,desynchronized:!0,willReadFrequently:!0});n&&(o.imageSmoothingEnabled=!0,o.imageSmoothingQuality=n),a&&(o.globalCompositeOperation=a);return o},o=(e,t)=>new OffscreenCanvas(e,t),r=e=>{const{height:t,width:n}=e;return{height:t,width:n}},l=(e,t)=>{i(t).putImageData(e,0,0)},s=function(e,t){let{x:n=0,y:a=0,width:o,height:l,imageSmoothingQuality:s,alpha:m,globalCompositeOperation:d}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const c=r(e),u=o||c.width,g=l||c.height,h=i(t,{imageSmoothingQuality:s,alpha:m,globalCompositeOperation:d});h.drawImage(e,n,a,u,g)},m=(e,t,n,a,i)=>{e.globalCompositeOperation=n;const{width:o,height:r}=t;e.drawImage(t,0,0,o,r,0,0,a,i)},d=e=>{let{canvas:t,image:n}=e;return s(n,t),t.transferToImageBitmap()}},3998:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(4855),i=n.n(a);const o=()=>{let e,t=!1,n=!0;return{init:()=>{t=!1,n=!0,e=new(i()),e.showPanel(0),document.body.appendChild(e.dom)},begin:()=>{e&&n&&!t&&(n=!1,t=!0,e.begin())},end:()=>{e&&t&&!n&&(n=!0,t=!1,e.end())},reset:()=>{document.body.removeChild(e.dom),e=void 0}}}},8446:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});const a=e=>{const t=document.createElement("video");return t.srcObject=e,new Promise((e=>{t.onloadedmetadata=()=>{t.width=t.videoWidth,t.height=t.videoHeight,t.play(),e(t)}}))}},5483:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k});var a=n(4200),i=n(3998),o=n(8446),r=n(9317);const l=e=>{let{videoSource:t,canvas:n,imageMask:a,personMask:i,edgeBlurAmount:o}=e;const{width:l,height:s}=t,m=(0,r.fw)(n);i?(m.save(),m.drawImage(t,0,0),o>0&&(m.filter=`blur(${o}px)`),(0,r.Ju)(m,i,"destination-out",l,s),m.filter="none",(0,r.Ju)(m,a,"destination-over",l,s),m.restore()):m.drawImage(t,0,0)};n(37),n(5439);var s=n(1627);n(934);let m={};const d=()=>{m={}},c=async e=>{const t=await s.wX(e,{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255},!0,.6),{width:n,height:a}=t,i=((e,t,n)=>{const a=`${e}_${t}_${n}`;return m[a]||(m[a]=(0,r.WS)(t,n)),m[a]})("blurredMask",n,a);return(0,r.Xr)(t,i),i.transferToImageBitmap()},u=async(e,t)=>{let{imageBitmap:n}=t;const a=await e.segmentPeople(n);if(Array.isArray(a)&&0===a.length)return;return c(a)},g=()=>{const e={},t=(t,n)=>{e[t]=n};return{getStateValue:t=>e[t],getState:()=>e,setStateValue:t,initState:e=>{let{modelSelection:n}=e;t("modelSelection",n)}}},{getState:h,initState:p,setStateValue:S}=g();let w;const v=s.oV.MediaPipeSelfieSegmentation,b=async e=>{let{modelSelection:t}=e;const n={runtime:"tfjs",modelType:t};w=await s.N7(v,n)},y=e=>{let{modelSelection:t}=e;return p({modelSelection:t}),d(),b({modelSelection:t})},B=e=>u(w,{imageBitmap:e}),f=e=>{let{modelSelection:t}=e;return S("modelSelection",t),d(),b({modelSelection:t})},k=e=>{let{imageBitmapMask360p:t,imageBitmapMask720p:n,imageBitmapMask1080p:s}=e;const m=(0,i.Z)(),d=new a.Z;let c,u,g,h=!1;let p=!1;const S=e=>{let{edgeBlurAmount:a}=e;const{width:i,height:o}=u,S=(0,r.WS)(i,o);let w;switch(i){case 640:w=t;break;case 1280:w=n;break;case 1920:w=s}let v,b=(0,r.EK)({image:u,canvas:S});m.init(),h=!0;const y=async()=>{m.begin(),p=!0,h&&(v=await B(b)),m.end(),p=!1,h&&(c=requestAnimationFrame(y))},f=()=>{b=(0,r.EK)({image:u,canvas:S}),l({personMask:v,edgeBlurAmount:a,videoSource:u,imageMask:w,canvas:g})};y().then((()=>{d.activate(),d.run(f,24)}))},w=e=>{let{mediaStream:t,modelSelection:n,edgeBlurAmount:a}=e;return y({modelSelection:n}).then((()=>(e=>(0,o.Z)(e).then((e=>(u=e,u))))(t))).then((()=>{const{width:e,height:t}=u;g=(0,r.vL)(e,t),S({edgeBlurAmount:a});return g.captureStream()}))},v=()=>(h=!1,window.cancelAnimationFrame(c),d.deactivate(),m.reset(),new Promise((e=>{const t=()=>{!1===p?e():setTimeout(t,100)};t()}))),b=()=>v().then((()=>{u&&(u.srcObject=null)}));return{start:w,restart:e=>{let{mediaStream:t,modelSelection:n,edgeBlurAmount:a}=e;return b().then((()=>w({mediaStream:t,modelSelection:n,edgeBlurAmount:a})))},changeParams:e=>{let{modelSelection:t,edgeBlurAmount:n}=e;return v().then((()=>f({modelSelection:t}))).then((()=>S({edgeBlurAmount:n})))},stop:b}}},7890:()=>{},134:()=>{},9797:()=>{}}]);
//# sourceMappingURL=946.cdf92a89.chunk.js.map